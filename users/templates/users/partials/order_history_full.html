{% load static %}

<div class="bg-white p-6 rounded-lg shadow-lg">
    <h2 class="text-2xl font-bold text-gray-900 mb-6 tracking-wide">
        История заказов
    </h2>
    
    {% if orders %}
        <div class="space-y-4">
            {% for order in orders %}
                <div class="border border-gray-200 rounded-lg p-4 cursor-pointer hover:bg-gray-50 transition-colors"
                     hx-get="{% url 'users:order_detail' order.id %}"
                     hx-target="#order-modal"
                     hx-swap="innerHTML"
                     onclick="document.getElementById('order-modal').classList.remove('hidden')">
                    <div class="flex justify-between items-start">
                        <div class="flex-1">
                            <p class="font-semibold text-base text-gray-900">Заказ #{{ order.order_code }}</p>
                            <p class="text-sm text-gray-600 mt-1">{{ order.created_at|date:"d.m.Y в H:i" }}</p>
                            <!-- Fixed patronymic order - now Фамилия Имя Отчество -->
                            <p class="text-sm text-gray-700 mt-2">
                                <span class="font-medium">Получатель:</span> {{ order.last_name }} {{ order.first_name }}{% if order.patronymic %} {{ order.patronymic }}{% endif %}
                            </p>
                            <p class="text-sm text-gray-700">
                                <span class="font-medium">Группа:</span> {{ order.group_number }}
                            </p>
                            <p class="text-sm text-gray-700">
                                <span class="font-medium">Адрес:</span> {{ order.get_delivery_address_display_full }}
                            </p>
                        </div>
                        <div class="text-right">
                            <span class="inline-block px-3 py-1 text-xs font-semibold rounded-full
                                {% if order.status == 'pending' %}bg-yellow-100 text-yellow-800
                                {% elif order.status == 'processing' %}bg-blue-100 text-blue-800
                                {% elif order.status == 'shipped' %}bg-purple-100 text-purple-800
                                {% elif order.status == 'delivered' %}bg-green-100 text-green-800
                                {% elif order.status == 'cancelled' %}bg-red-100 text-red-800
                                {% endif %}">
                                {{ order.get_status_display }}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Order Items Preview -->
                    <div class="mt-3 pt-3 border-t border-gray-100">
                        <p class="text-xs text-gray-600 mb-2">Товары:</p>
                        <div class="flex flex-wrap gap-2">
                            {% for item in order.items.all|slice:":3" %}
                                <span class="text-xs bg-gray-100 px-2 py-1 rounded">
                                    {{ item.product.name }} ({{ item.quantity }} шт.)
                                </span>
                            {% endfor %}
                            {% if order.items.count > 3 %}
                                <span class="text-xs text-gray-500">
                                    +{{ order.items.count|add:"-3" }} ещё
                                </span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="text-center py-12">
            <p class="text-gray-600 mb-4">У вас ещё не было заказов</p>
            <a href="{% url 'main:index' %}" 
               class="inline-block bg-gray-400 hover:bg-gray-500 text-white font-semibold py-2 px-6 rounded-lg transition-colors duration-200 text-sm tracking-wide">
                Начать покупки
            </a>
        </div>
    {% endif %}
</div>

<!-- Modal Container -->
<div id="order-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
    <!-- Modal content will be loaded here -->
</div>

<script>
function closeOrderModal() {
    document.getElementById('order-modal').classList.add('hidden');
    document.getElementById('order-modal').innerHTML = '';
}

// Close modal when clicking outside
document.getElementById('order-modal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeOrderModal();
    }
});
</script>